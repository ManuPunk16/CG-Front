<div class="app-container" [class.app-is-mobile]="mobileQuery.matches">
  <!-- Barra de navegación superior -->
  <mat-toolbar color="primary" class="app-toolbar">
    <button mat-icon-button (click)="sidenav.toggle()" *ngIf="currentUser()">
      <mat-icon>menu</mat-icon>
    </button>
    <h1 class="app-name">{{ title }}</h1>
    <span class="spacer"></span>

    <!-- Sección de usuario -->
    <div *ngIf="currentUser()" class="user-section">
      <span class="mr-3 session-timer" [class.session-warning]="sessionTimeLeft() < 300">
        Sesión: {{ formatSessionTime() }}
      </span>

      <button mat-button [matMenuTriggerFor]="userMenu" class="user-button">
        <mat-icon>account_circle</mat-icon>
        <span class="ml-1">{{ currentUser()?.username }}</span>
      </button>

      <mat-menu #userMenu="matMenu">
        <button mat-menu-item routerLink="/Perfil">
          <mat-icon>person</mat-icon>
          <span>Mi Perfil</span>
        </button>
        <button mat-menu-item (click)="logout()">
          <mat-icon>exit_to_app</mat-icon>
          <span>Cerrar Sesión</span>
        </button>
      </mat-menu>
    </div>
  </mat-toolbar>

  <!-- Contenedor principal con sidenav -->
  <mat-sidenav-container class="app-container-inner"
      [style.marginTop.px]="mobileQuery.matches ? 56 : 0">

    <!-- Menú lateral -->
    <mat-sidenav #sidenav
        [mode]="mobileQuery.matches ? 'over' : 'side'"
        [fixedInViewport]="mobileQuery.matches"
        [opened]="!mobileQuery.matches && !!currentUser()"
        [disableClose]="!mobileQuery.matches && !!currentUser()">

      <mat-nav-list *ngIf="currentUser()">
        <a mat-list-item [routerLink]="['/Entradas']" routerLinkActive="active">
          <mat-icon>inbox</mat-icon>
          <span class="ml-2">Entradas</span>
        </a>

        <a mat-list-item [routerLink]="['/Catalogos']" routerLinkActive="active" *ngIf="isAdmin()">
          <mat-icon>category</mat-icon>
          <span class="ml-2">Catálogos</span>
        </a>

        <a mat-list-item [routerLink]="['/Administracion']" routerLinkActive="active">
          <mat-icon>admin_panel_settings</mat-icon>
          <span class="ml-2">Panel de Administración</span>
        </a>

        <a mat-list-item [routerLink]="['/Entradas/panel-control']" routerLinkActive="active"
           *ngIf="isAdmin() || isDirectorGeneral()">
          <mat-icon>dashboard</mat-icon>
          <span class="ml-2">Panel de Control</span>
        </a>

        <a mat-list-item routerLink="/Perfil" routerLinkActive="active">
          <mat-icon>person</mat-icon>
          <span class="ml-2">Mi Perfil</span>
        </a>

        <a mat-list-item (click)="logout()">
          <mat-icon>exit_to_app</mat-icon>
          <span class="ml-2">Cerrar Sesión</span>
        </a>
      </mat-nav-list>
    </mat-sidenav>

    <!-- Contenido principal -->
    <mat-sidenav-content>
      <div class="content-wrapper">
        <router-outlet></router-outlet>
      </div>
    </mat-sidenav-content>
  </mat-sidenav-container>
</div>

